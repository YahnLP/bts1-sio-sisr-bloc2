---
author: YLP
title: ğŸ–¥ï¸ FICHE DE TP
---

# ğŸ–¥ï¸ FICHE TP Ã‰LÃˆVE
## TP S16 â€” PowerShell AD â€¢ Exercices IPv6

*DurÃ©e : ~2h30 â€” En binÃ´me â€” VM Windows Server avec AD DS*

---

## Contexte

SimIO SARL finalise la fusion avec Nexio. Vous devez automatiser la crÃ©ation de 10 comptes AD depuis un fichier CSV, puis vÃ©rifier le rÃ©sultat. En fin de sÃ©ance, vous travaillerez sur la notation IPv6 pour prÃ©parer la migration rÃ©seau future.

---

## PARTIE A â€” Prise en Main de PowerShell

### A1 â€” Exploration des Cmdlets

Ouvrir **PowerShell ISE** (en tant qu'Administrateur) et exÃ©cuter les commandes suivantes une par une. Pour chaque commande, noter ce qu'elle retourne dans le tableau ci-dessous.

```powershell
# Commandes Ã  exÃ©cuter
Get-Process | Select-Object -First 5 -Property Name, Id, CPU
Get-Service | Where-Object { $_.Status -eq "Running" } | Measure-Object
Get-ChildItem C:\ | Sort-Object -Property LastWriteTime -Descending | Select-Object -First 3
Get-ComputerInfo | Select-Object CsName, WindowsVersion, OsArchitecture
```

| **Commande** | **Ce que retourne** |
|---|---|
| `Get-Process ... First 5` | |
| `Get-Service ... Measure-Object` | |
| `Get-ChildItem ... Last Write` | |
| `Get-ComputerInfo ...` | |

âœ… Capturer les rÃ©sultats : **Capture A1**.

---

### A2 â€” Explorer les Objets avec `Get-Member`

```powershell
# DÃ©couvrir toutes les propriÃ©tÃ©s d'un objet Process
Get-Process | Get-Member

# AccÃ©der Ã  une propriÃ©tÃ© spÃ©cifique
$Processus = Get-Process | Sort-Object CPU -Descending | Select-Object -First 1
Write-Host "Processus le plus gourmand : $($Processus.Name) â€” CPU : $($Processus.CPU)"

# Explorer les propriÃ©tÃ©s d'un utilisateur AD
Import-Module ActiveDirectory
Get-ADUser -Identity "Administrateur" -Properties * | Get-Member
```

---

### A3 â€” Pipeline en Pratique

Construire les commandes PowerShell rÃ©pondant aux questions suivantes :

| **Question** | **Commande PowerShell Ã  Ã©crire** |
|---|---|
| Combien de services sont arrÃªtÃ©s sur ce serveur ? | |
| Quel est le processus consommant le plus de RAM ? | |
| Lister les utilisateurs AD dont le compte est dÃ©sactivÃ© | |

---

## PARTIE B â€” Script de CrÃ©ation d'Utilisateurs AD en Masse depuis CSV

### B1 â€” PrÃ©parer l'Environnement

**VÃ©rifier que le module AD est disponible :**

```powershell
Import-Module ActiveDirectory
Get-Command -Module ActiveDirectory | Measure-Object
# â†’ Doit retourner plusieurs dizaines de cmdlets
```

**CrÃ©er les OUs nÃ©cessaires (si elles n'existent pas) :**

```powershell
$Domaine = "DC=siosarl,DC=local"

$OUs = @("RH", "Informatique", "Comptabilite", "Direction", "Commercial")

foreach ($OU in $OUs) {
    try {
        New-ADOrganizationalUnit -Name $OU -Path $Domaine -ErrorAction Stop
        Write-Host "âœ… OU crÃ©Ã©e : $OU"
    }
    catch {
        Write-Host "âš ï¸  OU '$OU' existe dÃ©jÃ  â€” ignorÃ©."
    }
}
```

âœ… Capturer la liste des OUs dans la console ADUC : **Capture B1**.

---

### B2 â€” CrÃ©er le Fichier CSV

CrÃ©er le fichier `C:\Scripts\nouveaux_employes.csv` avec le contenu suivant :

```
Prenom,Nom,Service,Login,Email,Titre
Alice,Martin,RH,a.martin,a.martin@siosarl.local,ChargÃ©e RH
Bob,Dupont,Informatique,b.dupont,b.dupont@siosarl.local,Technicien SI
Claire,Durand,Direction,c.durand,c.durand@siosarl.local,Directrice
David,Lemaire,Informatique,d.lemaire,d.lemaire@siosarl.local,Administrateur RÃ©seau
Emma,Bernard,RH,e.bernard,e.bernard@siosarl.local,Assistante RH
Francois,Moreau,Comptabilite,f.moreau,f.moreau@siosarl.local,Comptable
Genevieve,Simon,Direction,g.simon,g.simon@siosarl.local,Assistante Direction
Hugo,Laurent,Commercial,h.laurent,h.laurent@siosarl.local,Commercial
Isabelle,Thomas,Comptabilite,i.thomas,i.thomas@siosarl.local,Responsable Compta
Julien,Robert,Commercial,j.robert,j.robert@siosarl.local,Commercial Senior
```

```powershell
# VÃ©rifier que le CSV est bien lisible
$Test = Import-Csv "C:\Scripts\nouveaux_employes.csv"
Write-Host "Nombre d'entrÃ©es dans le CSV : $($Test.Count)"
$Test | Format-Table -AutoSize
```

âœ… Capturer l'affichage du tableau CSV : **Capture B2**.

---

### B3 â€” Ã‰crire le Script de CrÃ©ation en Masse

CrÃ©er `C:\Scripts\creer_utilisateurs_ad.ps1` :

```powershell
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Script  : creer_utilisateurs_ad.ps1
# Auteur  : [Votre nom]
# Date    : [Date]
# Version : 1.0
# RÃ´le    : CrÃ©ation en masse d'utilisateurs Active Directory
#           depuis un fichier CSV â€” SimIO SARL (fusion Nexio)
# Epreuve : Portfolio BTS SIO SISR â€” CompÃ©tences B2.4 et B2.3
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# â”€â”€â”€ CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$FichierCSV       = "C:\Scripts\nouveaux_employes.csv"
$Domaine          = "DC=siosarl,DC=local"
$MotDePasseDefaut = "Nexio!2024"
$FichierLog       = "C:\Scripts\log_creation_ad.txt"
$Compteurs = @{
    Succes  = 0
    Echecs  = 0
    Ignores = 0
}

# â”€â”€â”€ FONCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function Ecrire-Log {
    param([string]$Message)
    $Horodatage = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $Ligne = "[$Horodatage] $Message"
    Write-Host $Ligne
    Add-Content -Path $FichierLog -Value $Ligne
}

# â”€â”€â”€ VÃ‰RIFICATIONS INITIALES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# VÃ©rifier que le module AD est disponible
if (-not (Get-Module -Name ActiveDirectory -ListAvailable)) {
    Write-Host "âŒ Module ActiveDirectory non disponible. ExÃ©cutez ce script sur un contrÃ´leur de domaine ou un poste avec RSAT." -ForegroundColor Red
    exit 1
}
Import-Module ActiveDirectory

# VÃ©rifier que le fichier CSV existe
if (-not (Test-Path $FichierCSV)) {
    Write-Host "âŒ Fichier CSV introuvable : $FichierCSV" -ForegroundColor Red
    exit 1
}

# â”€â”€â”€ DÃ‰BUT DU TRAITEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Ecrire-Log "========================================================"
Ecrire-Log " DÃ‰BUT DE CRÃ‰ATION â€” Fusion SimIO / Nexio"
Ecrire-Log " Fichier source : $FichierCSV"
Ecrire-Log "========================================================"

# â”€â”€â”€ CONVERSION DU MOT DE PASSE EN SECURSTRING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$MotDePasseSecurise = ConvertTo-SecureString $MotDePasseDefaut -AsPlainText -Force

# â”€â”€â”€ LECTURE ET TRAITEMENT DU CSV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$Employes = Import-Csv -Path $FichierCSV -Delimiter ","

foreach ($Employe in $Employes) {

    $NomComplet = "$($Employe.Prenom) $($Employe.Nom)"
    $Login      = $Employe.Login
    $Service    = $Employe.Service
    $OuPath     = "OU=$Service,$Domaine"
    $UPN        = $Employe.Email

    Ecrire-Log "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    Ecrire-Log "Traitement : $NomComplet ($Login) â€” Service : $Service"

    # â”€â”€â”€ VÃ©rifier si l'utilisateur existe dÃ©jÃ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    $UtilisateurExistant = Get-ADUser -Filter { SamAccountName -eq $Login } -ErrorAction SilentlyContinue

    if ($UtilisateurExistant) {
        Ecrire-Log "  âš ï¸  IgnorÃ© : L'utilisateur '$Login' existe dÃ©jÃ  dans l'AD."
        $Compteurs.Ignores++
        continue
    }

    # â”€â”€â”€ VÃ©rifier que l'OU existe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    try {
        Get-ADOrganizationalUnit -Filter { Name -eq $Service } -ErrorAction Stop | Out-Null
    }
    catch {
        Ecrire-Log "  âš ï¸  OU '$Service' introuvable. CrÃ©ation automatique..."
        try {
            New-ADOrganizationalUnit -Name $Service -Path $Domaine -ErrorAction Stop
            Ecrire-Log "  âœ… OU '$Service' crÃ©Ã©e."
        }
        catch {
            Ecrire-Log "  âŒ Impossible de crÃ©er l'OU '$Service' : $($_.Exception.Message)"
            $Compteurs.Echecs++
            continue
        }
    }

    # â”€â”€â”€ CrÃ©er l'utilisateur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    try {
        New-ADUser `
            -Name                  $NomComplet `
            -GivenName             $Employe.Prenom `
            -Surname               $Employe.Nom `
            -SamAccountName        $Login `
            -UserPrincipalName     $UPN `
            -EmailAddress          $Employe.Email `
            -Title                 $Employe.Titre `
            -Department            $Service `
            -Path                  $OuPath `
            -AccountPassword       $MotDePasseSecurise `
            -ChangePasswordAtLogon $true `
            -Enabled               $true `
            -Description           "ArrivÃ©e fusion Nexio â€” $(Get-Date -Format 'MM/yyyy')" `
            -ErrorAction           Stop

        Ecrire-Log "  âœ… Utilisateur crÃ©Ã© : $NomComplet ($Login) dans OU=$Service"
        $Compteurs.Succes++
    }
    catch {
        Ecrire-Log "  âŒ Ã‰chec de crÃ©ation pour '$Login' : $($_.Exception.Message)"
        $Compteurs.Echecs++
    }
}

# â”€â”€â”€ RAPPORT FINAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ecrire-Log "========================================================"
Ecrire-Log " RAPPORT FINAL DE CRÃ‰ATION"
Ecrire-Log "  âœ… CrÃ©ations rÃ©ussies  : $($Compteurs.Succes)"
Ecrire-Log "  âš ï¸  Doublons ignorÃ©s   : $($Compteurs.Ignores)"
Ecrire-Log "  âŒ Ã‰checs              : $($Compteurs.Echecs)"
Ecrire-Log "  Total traitÃ©          : $($Employes.Count)"
Ecrire-Log " Log complet            : $FichierLog"
Ecrire-Log "========================================================"
```

---

### B4 â€” ExÃ©cuter et VÃ©rifier

```powershell
# ExÃ©cuter le script
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
.\C:\Scripts\creer_utilisateurs_ad.ps1

# VÃ©rifier les utilisateurs crÃ©Ã©s
Get-ADUser -Filter * -SearchBase "DC=siosarl,DC=local" -Properties Department |
    Select-Object Name, SamAccountName, Department, Enabled |
    Sort-Object Department |
    Format-Table -AutoSize

# Lire le log de crÃ©ation
Get-Content C:\Scripts\log_creation_ad.txt
```

âœ… Capturer la liste des utilisateurs dans ADUC (console graphique) : **Capture B3**.
âœ… Capturer le log de crÃ©ation : **Capture B4**.

---

### B5 â€” Tester les Doublons

```powershell
# Relancer le script sans modifier le CSV
# â†’ Tous les utilisateurs doivent Ãªtre marquÃ©s "IgnorÃ©s" (doublons)
.\C:\Scripts\creer_utilisateurs_ad.ps1
```

âœ… Capturer le rapport final indiquant N doublons ignorÃ©s : **Capture B5**.

---

## PARTIE C â€” Exercices IPv6 : Notation et Types d'Adresses

### C1 â€” DÃ©compression d'Adresses

Ã‰crire la forme **complÃ¨te** (non abrÃ©gÃ©e) des adresses suivantes :

| **Adresse compressÃ©e** | **Adresse complÃ¨te (128 bits, 8 groupes de 4 hex)** |
|---|---|
| `::1` | |
| `FE80::1` | |
| `2001:db8::1` | |
| `2001:db8:0:1::` | |
| `FF02::1` | |

---

### C2 â€” Compression d'Adresses

Ã‰crire la forme **la plus courte possible** des adresses suivantes :

| **Adresse complÃ¨te** | **Adresse compressÃ©e** |
|---|---|
| `2001:0DB8:0000:0000:0000:0000:0000:0001` | |
| `FE80:0000:0000:0000:0204:61FF:FE9D:F156` | |
| `0000:0000:0000:0000:0000:0000:0000:0001` | |
| `2001:0DB8:ABCD:0012:0000:0000:0000:0001` | |
| `FF02:0000:0000:0000:0000:0000:0000:0001` | |

---

### C3 â€” Identification des Types d'Adresses

Identifier le **type** de chaque adresse et indiquer si elle est **routable sur Internet** :

| **Adresse** | **Type** | **Routable sur Internet ?** |
|---|---|---|
| `FE80::1` | | |
| `::1` | | |
| `2001:db8::1234` | | |
| `FC00::1` | | |
| `FF02::1` | | |
| `::` | | |

---

### C4 â€” SLAAC : Calculer une Adresse Link-Local

Pour une interface avec l'adresse MAC **`00:50:56:AB:CD:EF`**, calculer l'adresse link-local IPv6 gÃ©nÃ©rÃ©e par EUI-64 :

**Ã‰tape 1 :** DÃ©couper la MAC en deux blocs de 3 octets : `00:50:56` et `AB:CD:EF`

**Ã‰tape 2 :** InsÃ©rer `FF:FE` entre les deux blocs : `00:50:56:FF:FE:AB:CD:EF`

**Ã‰tape 3 :** Regrouper en hextets : `0050:56FF:FEAB:CDEF`

**Ã‰tape 4 :** Inverser le bit universel/local (7e bit du 1er octet) :
- Premier octet : `00` en binaire = `0000 0000`
- Bit 7 (0-indexÃ©) = le **bit U/L** = 0 â†’ inverser Ã  1
- `0000 0010` = `02`
- Premier hextet devient : `0250`

**Adresse link-local :** `FE80::` + `0250:56FF:FEAB:CDEF` = ________________

---

### C5 â€” Configurer une Adresse IPv6 sur Windows Server (optionnel)

```powershell
# Afficher les interfaces rÃ©seau et leurs adresses IPv6
Get-NetIPAddress -AddressFamily IPv6 | Format-Table InterfaceAlias, IPAddress, PrefixLength

# Afficher les adresses link-local gÃ©nÃ©rÃ©es automatiquement
Get-NetIPAddress -AddressFamily IPv6 | Where-Object { $_.IPAddress -like "FE80*" }
```

âœ… Capturer les adresses IPv6 prÃ©sentes sur le serveur : **Capture C1**.

---
